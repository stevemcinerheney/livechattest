<style type='text/css'>
	.embeddedServiceHelpButton .helpButton .uiButton {
		background-color: rgb(22, 56, 100);
		font-family: "Helvetica", sans-serif;
	}
	.embeddedServiceHelpButton .helpButton .uiButton:focus {
		outline: 1px solid #2a60a1;
	}
  .embeddedServiceHelpButton .uiButton {
   max-width: 16em !important; 
  }
</style>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script type='text/javascript' src='https://service.force.com/embeddedservice/5.0/esw.min.js'></script>
<script type='text/javascript'> 
 
	var initESW = function(gslbBaseURL) {
        console.log("QUT Chat initialized");
        //var studentId = document.querySelector('[data-testid="student-name"]').textContent
        var studentId = window._studentId;
        var visualforceId = window._visualforceId;
        var firstName = "SteveTest";
        var lastName = "McTest";
        console.log("Name =" + firstName);
      
      if(!firstName){
        console.log("first name not found");      
      }
		embedded_svc.settings.displayHelpButton = true; //Or false
		embedded_svc.settings.language = ''; //For example, enter 'en' or 'en-US'

		embedded_svc.settings.defaultMinimizedText = 'Chat with a Student Advisor'; //Defaults to Chat with an Expert
//      embedded_svc.settings.widgetWidth = "450px";
		//embedded_svc.settings.disabledMinimizedText = 'Chat with a Student Advisor'; //(Defaults to Agent Offline)

		//embedded_svc.settings.loadingText = ''; //(Defaults to Loading)
		//embedded_svc.settings.storageDomain = 'yourdomain.com'; //(Sets the domain for your deployment so that visitors can navigate subdomains during a chat session)

		// Settings for Chat
		//embedded_svc.settings.directToButtonRouting = function(prechatFormData) {
			// Dynamically changes the button ID based on what the visitor enters in the pre-chat form.
			// Returns a valid button ID.
		//};
		//embedded_svc.settings.prepopulatedPrechatFields = {}; //Sets the auto-population of pre-chat form fields
		//embedded_svc.settings.fallbackRouting = []; //An array of button IDs, user IDs, or userId_buttonId
		//embedded_svc.settings.offlineSupportMinimizedText = '...'; //(Defaults to Contact Us)

		embedded_svc.settings.enabledFeatures = ['LiveAgent'];
		embedded_svc.settings.entryFeature = 'LiveAgent';

      if(firstName!= null && firstName!=undefined && firstName!="") {
        console.log("First name found-" + firstName);
		embedded_svc.init(
		    'https://oesmp.my.salesforce.com',
            'https://forms.qutonline.edu.au/',
			gslbBaseURL,
			'00D6F000002WvKL',
			'QUT_Hub_chat',
			{
				baseLiveAgentContentURL: 'https://c.la1-c1-cdu.salesforceliveagent.com/content',
				deploymentId: '5722e000000001N',
				buttonId: '5732e000000001N',
				baseLiveAgentURL: 'https://d.la1-c1-cdu.salesforceliveagent.com/chat',
				eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04I5K000000002gUAA_17939ec56d2',
				isOfflineSupportEnabled: false
			}
		);
    
      embedded_svc.settings.extraPrechatFormDetails = 
        [
          {"label":"First Name","name":"FirstName","value":firstName,"transcriptFields":["Visitor_First_Name__c"],"displayToAgent":true},
          {"label":"Last Name","value":lastName,"transcriptFields":["Visitor_Last_Name__c"],"displayToAgent":false},
          {"label":"Email","value":"","transcriptFields":[],"displayToAgent":true},
          {"label":"Account Name","value":visualforceId,"transcriptFields":["VisualforceId__c"],"displayToAgent":true},
          {"label":"Student Id","value":studentId,"transcriptFields":["StudentId__c"],"displayToAgent":true}
        ]; 
      
      embedded_svc.settings.extraPrechatInfo = 
        [
          {
            "entityFieldMaps":
            [
              {"doCreate":false,"doFind":true,"fieldName":"AccountId","isExactMatch":true,"label":"Account Name"},
              {"doCreate":false,"doFind":true,"fieldName":"LastName","isExactMatch":true,"label":"Last Name"}, 
              {"doCreate":false,"doFind":true,"fieldName":"Email","isExactMatch":true,"label":"Email"}
            ],
            "entityName":"Account","saveToTranscript":"Account","showOnCreate":true
          }
        ];
	} else {
      console.log("Using session storage");
		embedded_svc.init(
			'https://oesmp.my.salesforce.com',
            'https://forms.qutonline.edu.au/',
			gslbBaseURL,
			'00D6F000002WvKL',
			'QUT_Hub_chat',
      {
				baseLiveAgentContentURL: 'https://c.la1-c1-cdu.salesforceliveagent.com/content',
				deploymentId: '5722e000000001N',
				buttonId: '5732e000000001N',
				baseLiveAgentURL: 'https://d.la1-c1-cdu.salesforceliveagent.com/chat',
				eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04I5K000000002gUAA_17939ec56d2',
				isOfflineSupportEnabled: false
			}
		);
    
      embedded_svc.settings.extraPrechatFormDetails = 
        [
          {"label":"First Name","name":"FirstName","value":sessionStorage.getItem("firstname"),"transcriptFields":[],"displayToAgent":true},
          {"label":"Last Name","value":sessionStorage.getItem("lastname"),"transcriptFields":[],"displayToAgent":false},
          {"label":"Email","value":"","transcriptFields":[],"displayToAgent":true},
          {"label":"Account Name","value":sessionStorage.getItem("vfid"),"transcriptFields":[],"displayToAgent":true}
        ]; 
      
      embedded_svc.settings.extraPrechatInfo = 
        [
          {
            "entityFieldMaps":
            [
              {"doCreate":false,"doFind":true,"fieldName":"AccountId","isExactMatch":true,"label":"Account Name"},
              {"doCreate":false,"doFind":true,"fieldName":"LastName","isExactMatch":true,"label":"Last Name"}, 
              {"doCreate":false,"doFind":true,"fieldName":"Email","isExactMatch":true,"label":"Email"}
            ],
            "entityName":"Account","saveToTranscript":"Account","showOnCreate":true
          }
        ];

  };
    }
	if (!window.embedded_svc) {
		var s = document.createElement('script');
		s.setAttribute('src', 'https://oesmp--oesmpfull.my.salesforce.com/embeddedservice/5.0/esw.min.js');
		s.onload = function() {
			initESW(null);          
		};
		document.body.appendChild(s);
	} else {
      
		initESW('https://service.force.com');
	}
</script>
